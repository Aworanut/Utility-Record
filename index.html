<!DOCTYPE html><html lang="th"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏≠‡∏û‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡πâ‡∏≥-‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans Thai', sans-serif;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors">
    <div class="max-w-4xl mx-auto p-4">
        <!-- Header -->
        <div class="bg-primary text-white rounded-lg p-6 mb-6 shadow-lg">
            <h1 class="text-2xl md:text-3xl font-bold text-center">üìä ‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡πâ‡∏≥-‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</h1>
            <p class="text-center text-primary-100 mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        </div>

        <!-- Tabs -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg mb-6">
            <div class="flex border-b border-gray-200 dark:border-gray-700">
                <button id="recordTab" class="tab-btn active flex-1 py-3 px-4 text-center font-medium transition-colors">
                    üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button id="historyTab" class="tab-btn flex-1 py-3 px-4 text-center font-medium transition-colors">
                    üìà ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ
                </button>
                <button id="settingsTab" class="tab-btn flex-1 py-3 px-4 text-center font-medium transition-colors">
                    ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>

            <!-- Record Tab -->
            <div id="recordContent" class="tab-content p-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Water Meter -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 mb-4 flex items-center">
                            üíß ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡πâ‡∏≥
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡πÄ‡∏•‡∏Ç‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                <input id="waterMeter" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" placeholder="0.00">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô</label>
                                <input id="waterDate" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            </div>
                            <button id="saveWater" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡πâ‡∏≥
                            </button>
                        </div>
                    </div>

                    <!-- Electric Meter -->
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-yellow-700 dark:text-yellow-300 mb-4 flex items-center">
                            ‚ö° ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡πÄ‡∏•‡∏Ç‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                <input id="electricMeter" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base" placeholder="0.00">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô</label>
                                <input id="electricDate" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                            </div>
                            <button id="saveElectric" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Period Selection -->
                <div class="mt-6 bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <select id="periodType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <option value="current_month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</option>
                                <option value="last_month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="last_3_months">3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="last_6_months">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                            </select>
                        </div>
                        <div id="customDateStart" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <input id="startDate" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                        <div id="customDateEnd" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                            <input id="endDate" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                        </div>
                    </div>
                    <button id="updatePeriod" class="mt-4 bg-primary hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
                    </button>
                </div>

                <!-- Current Usage Summary -->
                <div id="currentUsage" class="mt-6 bg-green-50 dark:bg-green-900/20 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-green-700 dark:text-green-300 mb-4">
                        üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ <span id="periodLabel">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                    </h3>
                    <div id="usageDetails" class="mb-4 text-sm text-gray-600 dark:text-gray-400 text-center">
                        <span id="periodDateRange"></span>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="waterUsage">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏ô‡πâ‡∏≥</div>
                            <div class="text-lg font-semibold text-blue-700 dark:text-blue-300" id="waterCost">‡∏ø0</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="electricUsage">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</div>
                            <div class="text-lg font-semibold text-yellow-700 dark:text-yellow-300" id="electricCost">‡∏ø0</div>
                        </div>
                    </div>
                    <div class="mt-4 text-center border-t pt-4 border-green-200 dark:border-green-700">
                        <div class="text-xl font-bold text-green-700 dark:text-green-300" id="totalCost">‡∏£‡∏ß‡∏°: ‡∏ø0</div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyContent" class="tab-content p-6 hidden">
                <div class="space-y-4">
                    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
                        <button id="clearHistory" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                        </button>
                    </div>
                    <div id="historyList" class="space-y-3">
                        <!-- History items will be added here -->
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsContent" class="tab-content p-6 hidden">
                <div class="space-y-6">
                    <!-- Google Sheets Integration -->
                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-green-700 dark:text-green-300 mb-4">‚òÅÔ∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Google Apps Script URL</label>
                                <input id="googleScriptUrl" type="url" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700 dark:text-white text-base">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô Google Sheets
                                </p>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button id="testConnection" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                                </button>
                                <button id="syncData" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    ‚ÜïÔ∏è ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </div>
                            <div id="connectionStatus" class="text-sm p-3 rounded-lg bg-gray-100 dark:bg-gray-800">
                                <span class="text-gray-500 dark:text-gray-400">üîò ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6">
                            <h4 class="font-semibold text-blue-700 dark:text-blue-300 mb-4">üíß ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                    <input id="waterBaseFee" type="number" step="0.01" value="8.50" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-base">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</label>
                                    <input id="waterUnitRate" type="number" step="0.01" value="18.00" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-base">
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6">
                            <h4 class="font-semibold text-yellow-700 dark:text-yellow-300 mb-4">‚ö° ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                    <input id="electricBaseFee" type="number" step="0.01" value="38.22" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-base">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</label>
                                    <input id="electricUnitRate" type="number" step="0.01" value="4.18" class="w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-base">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="saveSettings" class="w-full bg-primary hover:bg-purple-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-4 right-4 z-50"></div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
            <p id="confirmMessage" class="text-gray-600 dark:text-gray-400 mb-4"></p>
            <div class="flex justify-end space-x-3">
                <button id="confirmCancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirmOk" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition-colors">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Data storage (in memory since localStorage not available)
        let meterData = {
            water: [],
            electric: [],
            settings: {
                waterBaseFee: 8.50,
                waterUnitRate: 18.00,
                electricBaseFee: 38.22,
                electricUnitRate: 4.18
            }
        };

        // DOM elements
        const tabs = {
            record: document.getElementById('recordTab'),
            history: document.getElementById('historyTab'),
            settings: document.getElementById('settingsTab')
        };

        const contents = {
            record: document.getElementById('recordContent'),
            history: document.getElementById('historyContent'),
            settings: document.getElementById('settingsContent')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('waterDate').value = today;
            document.getElementById('electricDate').value = today;

            // Load settings to UI
            loadSettings();
            
            // Update current usage display
            updateCurrentUsage();
            
            // Update history display
            updateHistoryDisplay();

            // Tab switching
            Object.keys(tabs).forEach(tabName => {
                tabs[tabName].addEventListener('click', () => switchTab(tabName));
            });

            // Save buttons
            document.getElementById('saveWater').addEventListener('click', saveWaterReading);
            document.getElementById('saveElectric').addEventListener('click', saveElectricReading);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('clearHistory').addEventListener('click', () => {
                showConfirmDialog('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ', clearAllHistory);
            });

            // Period selection event listeners
            document.getElementById('periodType').addEventListener('change', handlePeriodTypeChange);
            document.getElementById('updatePeriod').addEventListener('click', updateCurrentUsage);
            
            // Google Sheets integration event listeners
            document.getElementById('testConnection').addEventListener('click', testGoogleSheetsConnection);
            document.getElementById('syncData').addEventListener('click', syncDataWithGoogleSheets);
            
            // Initialize period display
            updatePeriodDisplay();
            
            // Try to load data from Google Sheets on startup if URL is available
            tryAutoLoadFromGoogleSheets();

            // Modal event listeners
            document.getElementById('confirmCancel').addEventListener('click', hideConfirmDialog);
            document.getElementById('confirmOk').addEventListener('click', () => {
                if (window.confirmCallback) {
                    window.confirmCallback();
                }
                hideConfirmDialog();
            });
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            tabs[tabName].classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            contents[tabName].classList.remove('hidden');

            // Update history when switching to history tab
            if (tabName === 'history') {
                updateHistoryDisplay();
            }
        }

        function saveWaterReading() {
            const meter = parseFloat(document.getElementById('waterMeter').value);
            const date = document.getElementById('waterDate').value;

            if (!meter || !date) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const reading = {
                id: Date.now(),
                meter: meter,
                date: date,
                type: 'water'
            };

            meterData.water.push(reading);
            meterData.water.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Clear form
            document.getElementById('waterMeter').value = '';
            
            updateCurrentUsage();
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ô‡πâ‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function saveElectricReading() {
            const meter = parseFloat(document.getElementById('electricMeter').value);
            const date = document.getElementById('electricDate').value;

            if (!meter || !date) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const reading = {
                id: Date.now(),
                meter: meter,
                date: date,
                type: 'electric'
            };

            meterData.electric.push(reading);
            meterData.electric.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Clear form
            document.getElementById('electricMeter').value = '';
            
            updateCurrentUsage();
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function updateCurrentUsage() {
            const { startDate, endDate } = getCurrentPeriod();
            
            // Calculate water usage and cost for the selected period
            const waterUsage = calculateUsageForPeriod(meterData.water, startDate, endDate);
            const waterCost = calculateWaterCost(waterUsage);
            
            // Calculate electric usage and cost for the selected period
            const electricUsage = calculateUsageForPeriod(meterData.electric, startDate, endDate);
            const electricCost = calculateElectricCost(electricUsage);

            // Update display
            document.getElementById('waterUsage').textContent = waterUsage.toFixed(2);
            document.getElementById('waterCost').textContent = `‡∏ø${waterCost.toFixed(2)}`;
            document.getElementById('electricUsage').textContent = electricUsage.toFixed(2);
            document.getElementById('electricCost').textContent = `‡∏ø${electricCost.toFixed(2)}`;
            document.getElementById('totalCost').textContent = `‡∏£‡∏ß‡∏°: ‡∏ø${(waterCost + electricCost).toFixed(2)}`;
            
            // Update period display
            updatePeriodDisplay();
        }

        function calculateUsage(readings) {
            if (readings.length < 2) return 0;
            
            const currentReading = readings[readings.length - 1];
            const previousReading = readings[readings.length - 2];
            
            return Math.max(0, currentReading.meter - previousReading.meter);
        }

        function calculateUsageForPeriod(readings, startDate, endDate) {
            if (readings.length === 0) return 0;

            // Filter readings within the period
            const filteredReadings = readings.filter(reading => {
                const readingDate = new Date(reading.date);
                return readingDate >= startDate && readingDate <= endDate;
            });

            if (filteredReadings.length === 0) return 0;

            // Find readings at the start and end of the period
            let startReading = null;
            let endReading = null;

            // Get the closest reading before or at the start date
            for (let i = readings.length - 1; i >= 0; i--) {
                const readingDate = new Date(readings[i].date);
                if (readingDate <= startDate) {
                    startReading = readings[i];
                    break;
                }
            }

            // Get the closest reading before or at the end date
            for (let i = readings.length - 1; i >= 0; i--) {
                const readingDate = new Date(readings[i].date);
                if (readingDate <= endDate) {
                    endReading = readings[i];
                    break;
                }
            }

            // If we have both start and end readings, calculate the difference
            if (startReading && endReading && endReading.meter >= startReading.meter) {
                return endReading.meter - startReading.meter;
            }

            // If we only have readings within the period, calculate total usage
            if (filteredReadings.length >= 2) {
                const firstReading = filteredReadings[0];
                const lastReading = filteredReadings[filteredReadings.length - 1];
                return Math.max(0, lastReading.meter - firstReading.meter);
            }

            return 0;
        }

        function getCurrentPeriod() {
            const periodType = document.getElementById('periodType').value;
            const today = new Date();
            let startDate, endDate;

            switch (periodType) {
                case 'current_month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'last_month':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
                case 'last_3_months':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 3, 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'last_6_months':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 6, 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('startDate').value || today);
                    endDate = new Date(document.getElementById('endDate').value || today);
                    break;
                default:
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            }

            return { startDate, endDate };
        }

        function handlePeriodTypeChange() {
            const periodType = document.getElementById('periodType').value;
            const customDateStart = document.getElementById('customDateStart');
            const customDateEnd = document.getElementById('customDateEnd');

            if (periodType === 'custom') {
                customDateStart.classList.remove('hidden');
                customDateEnd.classList.remove('hidden');
                
                // Set default custom dates
                const today = new Date();
                const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                document.getElementById('startDate').value = firstDayOfMonth.toISOString().split('T')[0];
                document.getElementById('endDate').value = today.toISOString().split('T')[0];
            } else {
                customDateStart.classList.add('hidden');
                customDateEnd.classList.add('hidden');
            }

            updateCurrentUsage();
        }

        function updatePeriodDisplay() {
            const periodType = document.getElementById('periodType').value;
            const { startDate, endDate } = getCurrentPeriod();
            
            const periodLabels = {
                'current_month': '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                'last_month': '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß',
                'last_3_months': '3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß',
                'last_6_months': '6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß',
                'custom': '‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î'
            };

            document.getElementById('periodLabel').textContent = periodLabels[periodType] || '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô';
            
            const dateRange = `${startDate.toLocaleDateString('th-TH')} - ${endDate.toLocaleDateString('th-TH')}`;
            document.getElementById('periodDateRange').textContent = dateRange;
        }

        function calculateWaterCost(usage) {
            return meterData.settings.waterBaseFee + (usage * meterData.settings.waterUnitRate);
        }

        function calculateElectricCost(usage) {
            return meterData.settings.electricBaseFee + (usage * meterData.settings.electricUnitRate);
        }

        function loadSettings() {
            document.getElementById('waterBaseFee').value = meterData.settings.waterBaseFee;
            document.getElementById('waterUnitRate').value = meterData.settings.waterUnitRate;
            document.getElementById('electricBaseFee').value = meterData.settings.electricBaseFee;
            document.getElementById('electricUnitRate').value = meterData.settings.electricUnitRate;
        }

        function saveSettings() {
            meterData.settings.waterBaseFee = parseFloat(document.getElementById('waterBaseFee').value) || 0;
            meterData.settings.waterUnitRate = parseFloat(document.getElementById('waterUnitRate').value) || 0;
            meterData.settings.electricBaseFee = parseFloat(document.getElementById('electricBaseFee').value) || 0;
            meterData.settings.electricUnitRate = parseFloat(document.getElementById('electricUnitRate').value) || 0;

            updateCurrentUsage();
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const allReadings = [...meterData.water, ...meterData.electric]
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (allReadings.length === 0) {
                historyList.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>';
                return;
            }

            historyList.innerHTML = allReadings.map(reading => {
                const typeInfo = reading.type === 'water' 
                    ? { icon: 'üíß', name: '‡∏ô‡πâ‡∏≥', class: 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700' }
                    : { icon: '‚ö°', name: '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', class: 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700' };

                return `
                    <div class="border rounded-lg p-4 ${typeInfo.class}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-lg">${typeInfo.icon}</span>
                                    <span class="font-medium text-gray-700 dark:text-gray-300">‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå${typeInfo.name}</span>
                                </div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                    <div>‡πÄ‡∏•‡∏Ç‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå: ${reading.meter.toFixed(2)}</div>
                                    <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(reading.date).toLocaleDateString('th-TH')}</div>
                                </div>
                            </div>
                            <button onclick="deleteReading(${reading.id}, '${reading.type}')" class="text-red-500 hover:text-red-700 p-1">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteReading(id, type) {
            showConfirmDialog('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?', () => {
                meterData[type] = meterData[type].filter(reading => reading.id !== id);
                updateCurrentUsage();
                updateHistoryDisplay();
                showMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            });
        }

        function clearAllHistory() {
            meterData.water = [];
            meterData.electric = [];
            updateCurrentUsage();
            updateHistoryDisplay();
            showMessage('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            messageDiv.className = `${bgColor} text-white px-4 py-2 rounded-lg shadow-lg mb-2 transform translate-x-full transition-transform duration-300`;
            messageDiv.textContent = message;

            container.appendChild(messageDiv);

            // Animate in
            setTimeout(() => {
                messageDiv.classList.remove('translate-x-full');
            }, 100);

            // Remove after 3 seconds
            setTimeout(() => {
                messageDiv.classList.add('translate-x-full');
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        function showConfirmDialog(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.remove('hidden');
            window.confirmCallback = callback;
        }

        function hideConfirmDialog() {
            document.getElementById('confirmModal').classList.add('hidden');
            window.confirmCallback = null;
        }

        // Google Sheets Integration Functions
        async function testGoogleSheetsConnection() {
            const url = document.getElementById('googleScriptUrl').value.trim();
            
            if (!url) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Google Apps Script URL', 'error');
                return;
            }

            updateConnectionStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'testing');

            try {
                const response = await fetch(url + '?action=test', {
                    method: 'GET',
                    mode: 'cors'
                });

                if (response.ok) {
                    const result = await response.text();
                    updateConnectionStatus('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'connected');
                    showMessage('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            } catch (error) {
                updateConnectionStatus('‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message, 'error');
                showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        async function syncDataWithGoogleSheets() {
            const url = document.getElementById('googleScriptUrl').value.trim();
            
            if (!url) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            updateConnectionStatus('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'syncing');

            try {
                // First, try to load data from Google Sheets
                const loadResponse = await fetch(url + '?action=load', {
                    method: 'GET',
                    mode: 'cors'
                });

                if (loadResponse.ok) {
                    const loadedData = await loadResponse.json();
                    if (loadedData.success && loadedData.data) {
                        // Merge with existing data
                        if (loadedData.data.water) {
                            meterData.water = mergeReadings(meterData.water, loadedData.data.water);
                        }
                        if (loadedData.data.electric) {
                            meterData.electric = mergeReadings(meterData.electric, loadedData.data.electric);
                        }
                        if (loadedData.data.settings) {
                            meterData.settings = { ...meterData.settings, ...loadedData.data.settings };
                            loadSettings();
                        }
                    }
                }

                // Then save current data to Google Sheets
                const saveResponse = await fetch(url, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'save',
                        data: meterData
                    })
                });

                if (saveResponse.ok) {
                    const result = await saveResponse.json();
                    if (result.success) {
                        updateConnectionStatus('‚úÖ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'connected');
                        showMessage('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                        updateCurrentUsage();
                        updateHistoryDisplay();
                    } else {
                        throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                    }
                } else {
                    throw new Error('HTTP ' + saveResponse.status);
                }
            } catch (error) {
                updateConnectionStatus('‚ùå ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message, 'error');
                showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        async function tryAutoLoadFromGoogleSheets() {
            const url = document.getElementById('googleScriptUrl').value.trim();
            if (!url) return;

            try {
                const response = await fetch(url + '?action=load', {
                    method: 'GET',
                    mode: 'cors'
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.data) {
                        meterData = { ...meterData, ...result.data };
                        loadSettings();
                        updateCurrentUsage();
                        updateHistoryDisplay();
                        updateConnectionStatus('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'connected');
                    }
                }
            } catch (error) {
                // Silently fail for auto-load
                console.log('Auto-load failed:', error);
            }
        }

        function mergeReadings(existingReadings, newReadings) {
            // Create a map of existing readings by ID
            const existingMap = new Map(existingReadings.map(reading => [reading.id, reading]));
            
            // Add new readings that don't exist
            newReadings.forEach(reading => {
                if (!existingMap.has(reading.id)) {
                    existingReadings.push(reading);
                }
            });

            // Sort by date
            existingReadings.sort((a, b) => new Date(a.date) - new Date(b.date));
            return existingReadings;
        }

        function updateConnectionStatus(message, status) {
            const statusElement = document.getElementById('connectionStatus');
            const statusClasses = {
                'testing': 'bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300',
                'syncing': 'bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300',
                'connected': 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300',
                'error': 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300',
                'default': 'bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400'
            };

            // Reset classes
            statusElement.className = 'text-sm p-3 rounded-lg ' + (statusClasses[status] || statusClasses.default);
            statusElement.innerHTML = `<span>${message}</span>`;
        }

        // CSS for active tab
        const style = document.createElement('style');
        style.textContent = `
            .tab-btn.active {
                background-color: #5D5CDE;
                color: white;
            }
            .tab-btn:not(.active) {
                color: #6B7280;
            }
            .tab-btn:not(.active):hover {
                background-color: #F3F4F6;
            }
            .dark .tab-btn:not(.active):hover {
                background-color: #374151;
            }
            .dark .tab-btn:not(.active) {
                color: #9CA3AF;
            }
        `;
        document.head.appendChild(style);
    </script>


</body></html>